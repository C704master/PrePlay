# PrePlay - 预演伙伴 | 功能效果说明

---

## 一、功能总览

### 1.1 功能架构

PrePlay 采用三页面架构，为用户提供完整的"准备-训练-反馈"闭环体验：

```
┌─────────────────────────────────────────────────────────┐
│                    功能架构图                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────┐      │
│  │         首页 (app.py)                       │      │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐     │      │
│  │  │文件上传  │ │训练记录  │ │开始训练  │     │      │
│  │  └─────────┘ └─────────┘ └─────────┘     │      │
│  │  ┌─────────────────────────────────┐       │      │
│  │  │      知识库管理                 │       │      │
│  │  │  上传 / 列表 / 删除             │       │      │
│  │  └─────────────────────────────────┘       │      │
│  └─────────────────────────────────────────────┘      │
│                        ↓                              │
│  ┌─────────────────────────────────────────────┐      │
│  │      训练页 (pages/1_训练.py)              │      │
│  │  ┌─────────────────────────────────┐       │      │
│  │  │      红蓝双角对话              │       │      │
│  │  │  🔴 红方（严厉导师）          │       │      │
│  │  │  🔵 蓝方（心理教练）          │       │      │
│  │  └─────────────────────────────────┘       │      │
│  │  ┌─────────────────────────────────┐       │      │
│  │  │      对话历史显示             │       │      │
│  │  └─────────────────────────────────┘       │      │
│  │  ┌─────────────────────────────────┐       │      │
│  │  │      消息输入与发送           │       │      │
│  └─────────────────────────────────────────────┘      │
│                        ↓                              │
│  ┌─────────────────────────────────────────────┐      │
│  │      报告页 (pages/2_报告.py)              │      │
│  │  ┌─────────────────────────────────┐       │      │
│  │  │      训练统计卡片             │       │      │
│  │  └─────────────────────────────────┘       │      │
│  │  ┌─────────────────────────────────┐       │
│  │  │      Kimi AI 分析报告         │       │      │
│  │  └─────────────────────────────────┘       │      │
│  │  ┌─────────────────────────────────┐       │
│  │  │      对话记录与导出           │       │
│  └─────────────────────────────────────────────┘      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 1.2 核心功能列表

| 功能模块 | 功能点 | 说明 |
|---------|-------|------|
| **首页** | 文件上传 | 支持 txt、docx 格式，最大 5MB |
| | 知识库管理 | 查看已上传文件、删除文件、刷新列表 |
| | 训练记录 | 查看历史训练、继续训练、删除记录 |
| | 开始训练 | 检查知识库状态，跳转到训练页 |
| **训练页** | 红方对话 | 基于知识库提出挑战性问题 |
| | 蓝方对话 | 提供情感支持和认知重构 |
| | 上下文管理 | 红蓝方独立对话上下文 |
| | 实时保存 | 消息立即保存到数据库 |
| **报告页** | 统计汇总 | 对话轮次、消息分布 |
| | AI 分析 | Kimi 生成结构化训练报告 |
| | 对话导出 | Markdown + TXT 双格式 |

---

## 二、场景一：组会前夜的"模拟组会"

**使用场景**：明天就要组会汇报，今晚想通过 PrePlay 模拟一下导师可能会问什么问题，做到心中有数。

### 2.1 上传汇报材料

**【截图位置 1】首页上传文件界面**

```
┌─────────────────────────────────────────────────────────┐
│  📤 上传汇报材料                                        │
│  ┌─────────┐                                           │
│  │ 🔄 刷新  │                                           │
│  └─────────┘                                           │
│                                                         │
│  📚 共 0 个文件                                         │
│  ────────────────────────────────────────────────        │
│                                                         │
│  📤 上传新文件                                           │
│  ┌──────────────────────────────────────────────┐       │
│  │ 选择文件（支持 txt, docx，最大 5MB）          │       │
│  │ [浏览文件...]                                 │       │
│  └──────────────────────────────────────────────┘       │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 文件上传器支持拖拽和点击上传
- 文件格式限制为 txt、docx，大小限制为 5MB
- 上传前进行前端校验，减少无效请求

---

### 2.2 知识库文件列表展示

**【截图位置 2】上传成功后的知识库文件列表**

```
┌─────────────────────────────────────────────────────────┐
│  📤 上传汇报材料                                        │
│  ┌─────────┐                                           │
│  │ 🔄 刷新  │                                           │
│  └─────────┘                                           │
│                                                         │
│  📚 共 1 个文件                                         │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ ✅ 📄 汇报材料.txt                         │       │
│  │    类型: txt | 状态: 已解析                    │       │
│  │    上传时间: 2025-02-25 18:00               │       │
│  │    ✅ 已上传到知识库                           │       │
│  │                                   [🗑️]        │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│                                                         │
│  [上传新文件区域...]                                     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 文件上传成功后立即刷新列表，显示新文件
- 每个文件显示：文件名、类型、解析状态、上传时间
- "已上传到知识库"提示用户文件已就绪
- 右侧删除按钮允许用户移除文件
- 文件数量实时更新，"共 1 个文件"

---

### 2.3 训练页红方提问界面

**【截图位置 3】训练页初始状态 + 用户第一次发言**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页  🔴 红方(魔鬼导师)  |  🔵 蓝方(心理教练)   │
│  🔄 清空对话  📊 查看报告                               │
│  ────────────────────────────────────────────────        │
│  📚 当前知识库：1 个文件（已激活）                       │
│  💬 对话轮次：0                                         │
│  ────────────────────────────────────────────────        │
│  👋 训练开始！你可以直接输入内容发送给红方或蓝方         │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 我是做多模态情感识别研究的，主要是想汇报一下    │       │
│  │ 我的研究思路。                                │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ┌─────────────────────────────┐  ┌────────────────┐   │
│  │                             │  │ 🔴 发送给红方   │   │
│  │ 输入你的回答或问题...         │  │ 🔵 发送给蓝方   │   │
│  │                             │  └────────────────┘   │
│  │ [多行文本输入框]              │                       │
│  │                             │                       │
│  └─────────────────────────────┘                       │
│  ────────────────────────────────────────────────        │
│              ✅ 结束训练                                  │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 知识库激活状态实时显示："1 个文件（已激活）"
- 对话轮次从 0 开始，每次用户发言自动 +1
- 初始状态下显示欢迎提示："训练开始！你可以直接输入..."
- 两个发送按钮并排，用户可自由选择发送对象

---

### 2.4 用户回答后红方追问

**【截图位置 4】用户回答 + 红方第一次提问**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页  🔴 红方(魔鬼导师)  |  🔵 蓝方(心理教练)   │
│  🔄 清空对话  📊 查看报告                               │
│  ────────────────────────────────────────────────        │
│  📚 当前知识库：1 个文件（已激活）                       │
│  💬 对话轮次：1                                         │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 👤 你                            (14:32:15) │       │
│  │ 我是做多模态情感识别研究的，主要是想汇报一下    │       │
│  │ 我的研究思路。                                │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔴 红方魔鬼导师              (14:32:28)     │       │
│  │ 你的研究是针对什么应用场景设计的？学术价值和     │       │
│  │ 应用价值分别体现在哪里？如果评审问你"为什么     │       │
│  │ 这个研究有必要做"，你打算怎么回答？             │       │
│  │                                             │       │
│  │ [背景：淡红色 + 左侧红色边框]                   │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ┌─────────────────────────────┐  ┌────────────────┐   │
│  │ 我的回答...                  │  │ 🔴 发送给红方   │   │
│  │                             │  │ 🔵 发送给蓝方   │   │
│  └─────────────────────────────┘  └────────────────┘   │
│  ────────────────────────────────────────────────        │
│              ✅ 结束训练                                  │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 用户消息显示为灰色背景 + 灰色边框，代表中立客观
- 红方消息显示为淡红色背景 + 红色边框 (#E53E3E)，传递"严肃、挑战"的情感
- 每条消息显示时间戳（HH:MM:SS），增强真实感
- 对话轮次自动更新为 1
- 输入框上方显示知识库检索提示（如有）："📚 已基于知识库内容生成问题"

---

### 2.5 向蓝方求助获得安抚

**【截图位置 5】关键截图：用户表达自我怀疑 + 蓝方认知重构**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页  🔴 红方(魔鬼导师)  |  🔵 蓝方(心理教练)   │
│  🔄 清空对话  📊 查看报告                               │
│  ────────────────────────────────────────────────        │
│  📚 当前知识库：1 个文件（已激活）                       │
│  💬 对话轮次：3                                         │
│  ────────────────────────────────────────────────        │
│  [对话历史显示...]                                       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔴 红方魔鬼导师              (14:33:50)     │       │
│  │ 舆情监测？这个领域已经有很成熟的产品了，比如    │       │
│  │ 阿里巴巴的情感分析API。你说的"心理健康预警"，    │       │
│  │ 具体怎么实现？用户会主动上传自己的数据吗？这涉    │       │
│  │ 及隐私问题，你考虑过吗？                        │       │
│  │                                             │       │
│  │ 另外，你的创新点在哪里？我看材料里提到了"动态    │       │
│  │ 注意力融合网络"，但这只是方法层面的创新，不是     │       │
│  │ 问题层面的创新。                                │       │
│  └──────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 👤 你                            (14:34:18) │       │
│  │ 红方问的问题把我问住了...我觉得我准备得不够     │       │
│  │ 充分，这个研究好像没有我想的那么有价值。我是不    │       │
│  │ 是应该换个研究方向？                          │       │
│  └──────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔵 蓝方心理教练              (14:34:45)     │       │
│  │ 等一下，让我们重新看看刚才的提问。            │       │
│  │                                             │       │
│  │ 红方问的是"你的创新点在哪里"和"隐私问题怎么    │       │
│  │ 解决"，这两个问题都是针对研究设计的具体问题，    │       │
│  │ 而不是说你的研究没有价值。                     │       │
│  │                                             │       │
│  │ 被问住说明这两个问题你之前确实没考虑到，现在    │       │
│  │ 发现了反而是一件好事——你已经在训练中发现了问    │       │
│  │ 题，而不是在真实汇报时才发现。这不正是我们做    │       │
│  │ 预演的意义吗？                               │       │
│  │                                             │       │
│  │ 关于创新点，你可以这样想：                     │       │
│  │ • 现有方法大多采用固定权重融合，而你提出的是动    │       │
│  │   态注意力                                   │       │
│  │ • 现有方法对噪声鲁棒性差，而你加入了门控机制    │       │
│  │ • 问题层面的创新固然重要，但方法层面的创新也是    │       │
│  │   学术贡献                                   │       │
│  │                                             │       │
│  │ 要不要向红方澄清一下你的创新点？               │       │
│  │                                             │       │
│  │ [背景：淡蓝色 + 左侧蓝色边框]                   │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ┌─────────────────────────────┐  ┌────────────────┐   │
│  │                             │  │ 🔴 发送给红方   │   │
│  │ 输入你的回答或问题...         │  │ 🔵 发送给蓝方   │   │
│  │                             │  └────────────────┘   │
│  │ [多行文本输入框]              │                       │
│  └─────────────────────────────┘                       │
│  ────────────────────────────────────────────────        │
│              ✅ 结束训练                                  │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 蓝方消息显示为淡蓝色背景 + 蓝色边框 (#3182CE)，传递"温暖、支持"的情感
- 用户在红方质疑后表达自我怀疑："我准备得不够充分...是不是应该换个研究方向？"
- 蓝方进行认知重构：
  - "让我们重新看看这个问题" —— 暂停用户的负面情绪
  - "这是具体问题，不是说你的研究没有价值" —— 将批评与自我价值分离
  - "被问住是一件好事" —— 重构对"被问住"的认知
  - "要不要向红方澄清一下你的创新点？" —— 引导用户继续行动
- 整个过程体现了认知行为疗法（CBT）的应用
- 对话轮次更新为 3

**技术支撑**：
- 蓝方可以看到完整对话历史（包括红方的所有提问）
- 知识库 RAG 检索确保蓝方的建议与用户研究相关

---

### 2.6 训练结束后的报告页

**【截图位置 6】报告页统计卡片 + AI 报告**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页              📊 训练报告                     │
│  ────────────────────────────────────────────────        │
│  📈 训练摘要                                            │
│  ────────────────────────────────────────────────        │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐                      │
│  │ 18  │ │ 8   │ │ 5   │ │ 5   │                      │
│  │总消息│ │红提问│ │蓝回复│ │你回复│                      │
│  └─────┘ └─────┘ └─────┘ └─────┘                      │
│                                                         │
│  📚 知识库文件：汇报材料.txt                             │
│  🔄 对话轮次：5                                          │
│  ────────────────────────────────────────────────        │
│  🤖 AI 训练分析报告                                     │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ ✅ 报告生成成功！                              │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ### 📋 训练报告摘要                                    │
│                                                         │
│  ### 一、整体表现                                        │
│  本次训练共进行 5 轮对话，用户展现了良好的应答能力。     │
│  对红方的 5 个问题中，用户给出了 4 个直接回答，1 个求助   │
│  蓝方后再回答。                                         │
│                                                         │
│  ### 二、问答质量分析                                    │
│  **回答得好的问题：**                                   │
│  - 关于应用场景的回答（在线教育）具有针对性               │
│  - 对隐私问题的处理方案（联邦学习）思路清晰               │
│                                                         │
│  **有待改进的问题：**                                   │
│  - 创新点的阐述可以更具体，方法创新和应用创新的区别      │
│  │   需要进一步澄清                                     │       │
│                                                         │
│  ### 三、知识盲区盘点                                    │
│  1. 方法创新 vs 问题创新的学术定位差异                   │
│  2. 在线教育场景下的具体应用细节                         │
│  3. 消融实验结果的显著性论证                             │
│                                                         │
│  ### 四、心理状态分析                                    │
│  训练中期（第 3 轮）用户出现明显的自我怀疑情绪，         │
│  表现为"觉得准备不充分"、"是否换研究方向"等表达。         │
│  经过蓝方的认知重构干预，后半程用户状态恢复，能够       │
│  积极回应红方的追问。                                   │
│                                                         │
│  ### 五、改进建议                                        │
│  1. 准备一页 PPT 专门对比现有方法与你的方法的差异        │
│  2. 针对创新点准备 2-3 个具体案例说明                   │
│  3. 梳理消融实验的数据，准备解释为什么 1.6% 的提升      │
│  │   是有意义的                                      │       │
│  4. 建议在答辩前 1 天进行第二轮高强度训练              │       │
│                                                         │
│  ────────────────────────────────────────────────        │
│  📝 对话记录                                            │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 轮次 │ 角色   │ 内容              │ 时间   │        │
│  ├─────┼────────┼───────────────────┼─────────┤       │
│  │  1  │ 👤 你  │ 我是做多模态...    │14:32:15 │       │
│  │  2  │ 🤖 红方 │ 你的研究是针对...  │14:32:28 │       │
│  │  3  │ 👤 你  │ 我的回答...        │14:33:05 │       │
│  │ ... │   ...  │       ...        │   ...   │       │
│  └──────────────────────────────────────────────┘       │
│  👁️ 查看完整对话                                       │
│  ────────────────────────────────────────────────        │
│  📥 导出报告                                            │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────┐  ┌──────────────────┐            │
│  │ 📄 导出AI报告     │  │ 📝 导出对话记录    │            │
│  │ (Markdown)        │  │ (TXT)            │            │
│  └──────────────────┘  └──────────────────┘            │
│  ────────────────────────────────────────────────        │
│  ┌─────────┐       ┌─────────┐                         │
│  │🔄新建训练│       │🏠返回首页│                         │
│  └─────────┘       └─────────┘                         │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- Metric 卡片展示核心数据：18 条总消息、8 条红方提问、5 条蓝方回复、5 条用户回复
- Kimi AI 生成结构化报告，包含 5 个维度：
  - 整体表现：训练过程的总体评价
  - 问答质量分析：哪些回答得好、哪些需要改进
  - 知识盲区盘点：被问住的知识点汇总
  - 心理状态分析：训练过程中的情绪变化
  - 改进建议：针对性的提升建议和后续训练计划
- 对话记录表格显示所有对话的概览
- 可展开查看完整对话
- 支持双格式导出：Markdown（AI 报告）+ TXT（原始对话）

**技术支撑**：
- Kimi 长文本分析能力：生成结构化、有深度的训练报告
- SQLite 统计查询：快速汇总训练数据
- 文件导出：Streamlit download_button 实现

---

## 三、场景二：历史训练的回顾与继续

**使用场景**：一周前进行过组会前的训练，现在准备中期答辩，想回顾一下之前的训练记录，然后继续新的训练。

### 3.1 首页训练记录列表

**【截图位置 7】首页显示多条训练记录**

```
┌─────────────────────────────────────────────────────────┐
│  🎯 开始训练  📊 查看报告  ⚙️ 设置                     │
│  ────────────────────────────────────────────────        │
│  📚 训练记录                                            │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 📄 训练-a3f8d1                               │       │
│  │ 📁 汇报材料.txt                                │       │
│  │ 🕐 2025-02-25 18:30  💬 8 轮对话              │       │
│  │                                  [🔄 继续]  │       │
│  │                                  [🗑️ 删除]  │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 📄 训练-b7c2e9                               │       │
│  │ 🕐 2025-02-18 15:20  💬 5 轮对话              │       │
│  │                                  [🔄 继续]  │       │
│  │                                  [🗑️ 删除]  │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  📤 上传汇报材料                                        │
│  [文件列表...]                                          │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 训练记录按时间倒序排列，最新的显示在最上方
- 每条记录显示：训练标题、关联文件、创建时间、对话轮次
- "继续"按钮：加载历史对话，恢复到训练状态
- "删除"按钮：删除训练记录及其对话数据
- 数据持久化：即使页面刷新，训练记录依然存在

**技术支撑**：
- SQLite 数据库存储训练会话和消息
- session_id 关联训练记录与对话消息
- 支持会话恢复：点击"继续"加载历史消息到 session_state

---

### 3.2 点击"继续"加载历史对话

**【截图位置 8】训练页加载历史对话**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页  🔴 红方(魔鬼导师)  |  🔵 蓝方(心理教练)   │
│  🔄 清空对话  📊 查看报告                               │
│  ────────────────────────────────────────────────        │
│  📚 当前知识库：1 个文件（已激活）                       │
│  💬 对话轮次：8                                         │
│  ────────────────────────────────────────────────        │
│  ┌──────────────────────────────────────────────┐       │
│  │ 👤 你                            (18:30:05) │       │
│  │ 我是做多模态情感识别研究的，主要是想汇报一下    │       │
│  │ 我的研究思路。                                │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔴 红方魔鬼导师              (18:30:28)     │       │
│  │ 你的研究是针对什么应用场景设计的？学术价值和     │       │
│  │ 应用价值分别体现在哪里？如果评审问你"为什么     │       │
│  │ 这个研究有必要做"，你打算怎么回答？             │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  [更多历史对话...]                                     │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔵 蓝方心理教练              (18:45:32)     │       │
│  │ ...经过蓝方的认知重构，你成功澄清了创新点...   │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ✅ 已加载历史训练记录 (8 轮对话)                       │
│  ────────────────────────────────────────────────        │
│  ┌─────────────────────────────┐  ┌────────────────┐   │
│  │                             │  │ 🔴 发送给红方   │   │
│  │ 输入你的回答或问题...         │  │ 🔵 发送给蓝方   │   │
│  │                             │  └────────────────┘   │
│  │ [多行文本输入框]              │                       │
│  └─────────────────────────────┘                       │
│  ────────────────────────────────────────────────        │
│              ✅ 结束训练                                  │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 成功加载提示："已加载历史训练记录 (8 轮对话)"
- 对话轮次恢复为 8
- 所有历史消息完整恢复，包括时间戳
- 知识库文件状态同步恢复
- 用户可以立即继续对话，无需重新开始

**技术支撑**：
- 从数据库加载训练会话的所有消息
- 转换消息格式并添加到 chat_history
- 恢复知识库 file_ids
- 保持原有的 session_id，避免创建新会话

---

### 3.3 基于历史对话继续训练

**【截图位置 9】继续对话】

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页  🔴 红方(魔鬼导师)  |  🔵 蓝方(心理教练)   │
│  🔄 清空对话  📊 查看报告                               │
│  ────────────────────────────────────────────────        │
│  📚 当前知识库：1 个文件（已激活）                       │
│  💬 对话轮次：9                                         │
│  ────────────────────────────────────────────────        │
│  [历史对话...]                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │ 🔴 红方魔鬼导师              (18:45:55)     │       │
│  │ 让我们换个角度，如果你要向一个非计算机专业的     │       │
│  │ 人解释你的研究，你会怎么说？                  │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────┐       │
│  │ 👤 你                            (18:50:12) │       │
│  │ 就好比我们看视频的时候，有时候光看画面不太     │       │
│  │ 确定一个人是不是开心，因为表情可能是假的；     │       │
│  │ 但如果同时听他的声音，就能更准确地判断...     │       │
│  │                                             │       │
│  └──────────────────────────────────────────────┘       │
│  ────────────────────────────────────────────────        │
│  ┌─────────────────────────────┐  ┌────────────────┐   │
│  │                             │  │ 🔴 发送给红方   │   │
│  │ 输入你的回答或问题...         │  │ 🔵 发送给蓝方   │   │
│  │                             │  └────────────────┘   │
│  │ [多行文本输入框]              │                       │
│  └─────────────────────────────┘                       │
│  ────────────────────────────────────────────────        │
│              ✅ 结束训练                                  │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 新对话紧接历史对话，用户无缝继续
- 对话轮次从 8 更新到 9
- 红方上下文包含历史对话，能够基于之前的交流继续提问
- 蓝方可以看到完整对话历史，包括继续后的新消息

---

## 四、场景三：训练报告的深度分析

**使用场景**：完成一轮高强度训练后，需要系统性的反馈来总结训练成果，发现盲区，制定后续计划。

### 4.1 AI 报告生成的统计卡片

**【截图位置 10】报告页 Metric 卡片特写**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页              📊 训练报告                     │
│  ────────────────────────────────────────────────        │
│  📈 训练摘要                                            │
│  ────────────────────────────────────────────────        │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │          18                                   │       │
│  │       总消息数                                 │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │          8                                   │       │
│  │       🔴 红方提问                            │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │          5                                   │       │
│  │       🔵 蓝方回复                            │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │          5                                   │       │
│  │       💬 你的回复                            │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  📚 知识库文件：汇报材料.txt                             │
│  🔄 对话轮次：5                                          │
│  ────────────────────────────────────────────────        │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- Streamlit Metric 组件提供大字体数字显示，视觉效果突出
- 每个 Metric 有明确的标签：总消息数、红方提问、蓝方回复、你的回复
- 红蓝两方的消息数量对比，直观展示训练中的互动情况
- 对话轮次独立显示，是训练强度的重要指标

---

### 4.2 Kimi 生成的结构化分析报告

**【截图位置 11】Kimi AI 报告完整内容】

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页              📊 训练报告                     │
│  ────────────────────────────────────────────────        │
│  📈 训练摘要  [Metric 卡片]                           │
│  ────────────────────────────────────────────────        │
│  🤖 AI 训练分析报告                                     │
│  ────────────────────────────────────────────────        │
│  ✅ 报告生成成功！                                      │
│  ────────────────────────────────────────────────        │
│  ### 📋 训练报告摘要                                    │
│                                                         │
│  ### 一、整体表现                                        │
│  本次训练共进行 5 轮对话，用户展现了良好的应答能力。     │
│  对红方的 8 个问题中，用户给出了 5 个直接回答，3 个求助   │
│  蓝方后再回答。整体来看，用户对研究内容熟悉，能够         │
│  应对常规提问，但在创新点阐述方面存在不足。              │
│                                                         │
│  ### 二、问答质量分析                                    │
│  **回答得好的问题：**                                   │
│  - 应用场景的回答（在线教育）具有针对性和实用性           │
│  - 隐私问题的处理方案（联邦学习）思路清晰、可行          │
│  - 对动态注意力机制的说明逻辑自洽                        │
│                                                         │
│  **有待改进的问题：**                                   │
│  - 创新点的阐述需要更具体，"方法创新"和"应用创新"的     │
│  │   区别需要进一步澄清                                 │       │
│  - 对消融实验结果的显著性论证不足，1.6% 的提升如何      │
│  │   说服评审                                         │       │
│  - 在线教育场景下的具体应用细节可以更深入               │
│                                                         │
│  ### 三、知识盲区盘点                                    │
│  1. 方法创新 vs 问题创新的学术定位差异                   │
│  2. 在线教育场景下的具体应用挑战                         │
│  3. 消融实验结果的统计学显著性检验                       │
│  4. 与现有方法的详细对比（包括数据集、实验设置）         │
│                                                         │
│  ### 四、心理状态分析                                    │
│  训练过程中的心理状态变化如下：                          │
│  - 第 1-2 轮：正常状态，用户能自如介绍研究               │
│  - 第 3-4 轮：焦虑状态，红方质疑创新点和隐私问题后，      │
│  │   用户出现自我怀疑表达（"准备不充分"、"是否换方向"）│       │
│  - 第 5-8 轮：恢复状态，经过蓝方认知重构后，用户       │
│  │   重新建立信心，能够积极回应                         │       │
│                                                         │
│  建议：在真实汇报前，针对第 3-4 轮的焦虑点进行专项       │
│  准备，建立心理预案。                                   │
│                                                         │
│  ### 五、改进建议                                        │
│  **内容准备：**                                          │
│  1. 准备一页 PPT 专门对比现有方法与你的方法差异，         │
│  │   包括模型结构、融合方式、计算效率等维度             │       │
│  2. 针对创新点准备 2-3 个具体案例说明，例如：           │
│  │   "在模态缺失场景下，动态权重的优势体现在哪里"      │       │
│  3. 梳理消融实验的数据，准备解释为什么 1.6% 的提升      │
│  │   是有意义的（如：在困难样本上的提升更明显）        │       │
│                                                         │
│  **心理准备：**                                          │
│  1. 提前准备 3 个可能的反驳问题及其应对策略             │
│  2. 练习将"被问住"重新定义为"发现成长机会"             │
│  3. 建立心理预案：如果评审质疑创新点，你打算怎么回应     │
│                                                         │
│  **后续训练：**                                          │
│  1. 针对知识盲区进行专项复习                           │
│  2. 建议在答辩前 3 天进行第二轮高强度训练               │
│  3. 考虑针对"技术细节深度"和"应用场景宽度"分别训练      │
│                                                         │
│  ────────────────────────────────────────────────        │
│  📝 对话记录                                            │
│  ────────────────────────────────────────────────        │
│  [对话记录表格]                                         │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- Kimi 基于完整对话记录生成结构化报告
- 报告分为 5 个维度，每个维度都有具体分析
- "心理状态分析"是 PrePlay 的特色功能，追踪用户情绪变化
- "改进建议"提供可执行的行动指南
- Markdown 渲染支持，报告格式清晰易读

**技术支撑**：
- Kimi 长文本分析能力（kimi-k2-turbo-preview 模型）
- 对话记录的 JSON 结构化处理
- Prompt 工程确保报告结构一致

---

### 4.3 报告导出功能演示

**【截图位置 12】导出功能界面 + 文件下载提示**

```
┌─────────────────────────────────────────────────────────┐
│  🔙 返回首页              📊 训练报告                     │
│  ────────────────────────────────────────────────        │
│  [报告内容...]                                         │
│  ────────────────────────────────────────────────        │
│  📥 导出报告                                            │
│  ────────────────────────────────────────────────        │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │         📄                                    │       │
│  │   导出 AI 报告 (Markdown)                      │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  ┌──────────────────────────────────────────────┐       │
│  │                                              │       │
│  │         📝                                    │       │
│  │   导出对话记录 (TXT)                           │       │
│  │                                              │       │
│  └──────────────────────────────────────────────┘       │
│                                                         │
│  ────────────────────────────────────────────────        │
│  ┌─────────┐       ┌─────────┐                         │
│  │🔄新建训练│       │🏠返回首页│                         │
│  └─────────┘       └─────────┘                         │
│                                                         │
│  ────────────────────────────────────────────────        │
│  [浏览器下载提示：PrePlay_AI报告_20250225_193045.md   │
│  │     已保存到下载文件夹]                               │
└─────────────────────────────────────────────────────────┘
```

**功能效果说明**：
- 两个导出按钮并排，用户可选择所需格式
- AI 报告导出为 Markdown，支持在 Typora、Obsidian 等工具中编辑
- 对话记录导出为 TXT，格式简单，便于阅读和存档
- 文件名包含时间戳，便于区分不同训练的报告
- 点击按钮后浏览器自动下载，无需额外操作

**技术支撑**：
- Streamlit download_button 组件
- 文件名动态生成（包含时间戳）
- MIME 类型设置正确（text/markdown 和 text/plain）

---

## 五、技术效果说明

### 5.1 知识库 RAG 检索效果

**提问与材料的相关性验证**

PrePlay 的核心优势在于：红方提出的问题基于用户上传的真实材料，而非随机生成。

**示例对比：**

| 场景 | 无知识库（随机问题） | 有知识库（RAG 检索） |
|-----|-------------------|------------------|
| 用户研究多模态情感识别 | "你对情感识别有什么看法？" | "你的研究是针对什么应用场景设计的？现有方法有哪些不足？" |
| 用户材料提到"动态注意力融合网络" | "你的模型结构是怎样的？" | "材料里提到了动态注意力融合网络，这与传统的固定权重融合有什么区别？" |

**技术实现：**
- 讯飞知识库 API 进行语义检索
- 检索结果注入 Prompt 构建增强输入
- 匹配阈值设置为 0.83，确保相关性

---

### 5.2 多 Agent 协同效果

**红蓝上下文差异化**

PrePlay 创新性地让红蓝两方使用不同的对话上下文，从而形成不同的角色人设。

| Agent | 上下文范围 | 效果 |
|-------|----------|------|
| 红方（严厉导师） | 仅包含用户与红方的交互 | 保持"严厉、聚焦问题"的人设，不知道用户与蓝方的交流 |
| 蓝方（心理教练） | 包含完整对话历史 | 能够基于全局情况提供情感支持和认知重构 |

**对话示例对比：**

- **红方看不到用户与蓝方的交流**，因此不会重复蓝方已经给过的建议
- **蓝方可以看到红方的所有提问**，因此能够针对性地进行认知重构

这种设计确保了角色人设的一致性，避免了"两个 Agent 互相知道对方的回应"的混乱情况。

---

### 5.3 系统鲁棒性

**页面刷新对话不丢失**

PrePlay 采用 SQLite 本地持久化，确保训练记录在页面刷新后依然存在。

**测试场景：**

```
1. 用户在训练页进行 5 轮对话
2. 用户不小心刷新浏览器页面
3. 页面重新加载后，训练记录依然存在
4. 用户可以继续之前的对话
```

**技术实现：**
- 每条消息立即保存到 SQLite 数据库
- session_id 关联用户会话
- 页面加载时从数据库恢复历史消息
- 刷新操作不会导致数据丢失

---

## 六、功能效果总结

### 6.1 核心功能达成度

| 功能模块 | 达成情况 | 说明 |
|---------|---------|------|
| 文件上传与知识库管理 | ✅ 完成 | 支持 txt/docx，文件校验，列表展示 |
| 红蓝双角对话 | ✅ 完成 | 上下文差异化，RAG 检索增强 |
| 训练记录管理 | ✅ 完成 | 持久化存储，继续训练功能 |
| 统计与报告 | ✅ 完成 | Metric 卡片，Kimi AI 分析报告 |
| 报告导出 | ✅ 完成 | Markdown + TXT 双格式 |

### 6.2 用户体验亮点

1. **红蓝双角情感化交互**：超越传统 Chatbot，形成"压力-支持"的情绪调节机制
2. **实时保存安全感**：用户无需担心数据丢失，可随时离开再回来
3. **成长的可视化**：训练记录、统计卡片、AI 报告，都是成长的证据
4. **灵活的交互方式**：随时切换红蓝、随时清空、随时结束、随时继续

### 6.3 技术稳定性

- **系统鲁棒性**：页面刷新、网络中断不影响核心体验
- **降级机制**：知识库检索失败自动降级为常规对话
- **错误隔离**：单个 Agent 失败不影响其他 Agent

---

## 附录：截图清单

| 编号 | 截图内容 | 对应章节 | 说明 |
|-----|---------|---------|------|
| 截图 1 | 首页上传文件界面 | 2.1 | 文件上传器 |
| 截图 2 | 知识库文件列表 | 2.2 | 上传成功后的文件展示 |
| 截图 3 | 训练页初始状态 | 2.3 | 用户第一次发言 |
| 截图 4 | 用户回答 + 红方提问 | 2.4 | 红方第一次提问 |
| 截图 5 | 用户自我怀疑 + 蓝方认知重构 | 2.5 | **关键截图** |
| 截图 6 | 训练结束后的报告页 | 2.6 | 完整报告展示 |
| 截图 7 | 首页训练记录列表 | 3.1 | 历史记录展示 |
| 截图 8 | 训练页加载历史对话 | 3.2 | 继续训练功能 |
| 截图 9 | 继续对话 | 3.3 | 基于历史继续训练 |
| 截图 10 | 报告页 Metric 卡片 | 4.1 | 统计数据展示 |
| 截图 11 | Kimi AI 报告完整内容 | 4.2 | 结构化分析报告 |
| 截图 12 | 导出功能界面 | 4.3 | 文件下载演示 |

---

**"功能为用户服务，效果为价值说话"**
